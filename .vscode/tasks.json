{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start PostgreSQL (Docker)",
      "type": "shell",
      "command": "docker",
      "args": [
        "compose",
        "-f",
        "${workspaceFolder}/docker-compose.dev.yml",
        "up",
        "-d"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared",
        "focus": false,
        "clear": false
      },
      "runOptions": {
        "runOn": "default"
      }
    },
    {
      "label": "Stop PostgreSQL (Docker)",
      "type": "shell",
      "command": "docker",
      "args": [
        "compose",
        "-f",
        "${workspaceFolder}/docker-compose.dev.yml",
        "down"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Clean Next.js Lock",
      "type": "shell",
      "command": "rm",
      "args": [
        "-f",
        "${workspaceFolder}/frontend/.next/dev/lock"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared"
      },
      "windows": {
        "command": "powershell",
        "args": [
          "-Command",
          "Remove-Item -Force -ErrorAction SilentlyContinue '${workspaceFolder}/frontend/.next/dev/lock'"
        ]
      }
    },
    {
      "label": "Kill Process on Port 3003",
      "type": "shell",
      "command": "lsof",
      "args": [
        "-ti:3003",
        "|",
        "xargs",
        "kill",
        "-9"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared"
      },
      "windows": {
        "command": "powershell",
        "args": [
          "-Command",
          "Get-NetTCPConnection -LocalPort 3003 -ErrorAction SilentlyContinue | ForEach-Object { Stop-Process -Id $_.OwningProcess -Force -ErrorAction SilentlyContinue }"
        ]
      },
      "linux": {
        "command": "sh",
        "args": [
          "-c",
          "lsof -ti:3003 | xargs -r kill -9 2>/dev/null || true"
        ]
      },
      "osx": {
        "command": "sh",
        "args": [
          "-c",
          "lsof -ti:3003 | xargs -r kill -9 2>/dev/null || true"
        ]
      }
    },
    {
      "label": "Kill Process on Port 8008",
      "type": "shell",
      "command": "sh",
      "args": [
        "-c",
        "lsof -ti:8008 | xargs -r kill -9 2>/dev/null || true"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared"
      },
      "windows": {
        "command": "powershell",
        "args": [
          "-Command",
          "Get-NetTCPConnection -LocalPort 8008 -ErrorAction SilentlyContinue | ForEach-Object { Stop-Process -Id $_.OwningProcess -Force -ErrorAction SilentlyContinue }"
        ]
      }
    },
    {
      "label": "Clean Ports and Locks",
      "dependsOn": [
        "Kill Process on Port 3003",
        "Kill Process on Port 8008",
        "Clean Next.js Lock"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared"
      }
    },
    {
      "label": "Full Stack: Pre-Launch",
      "dependsOn": [
        "Clean Ports and Locks",
        "Start PostgreSQL (Docker)"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared"
      }
    },
    {
      "label": "Backend: Install Dependencies",
      "type": "shell",
      "command": "uv",
      "args": [
        "sync"
      ],
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "uv.exe"
      }
    },
    {
      "label": "Frontend: Install Dependencies",
      "type": "shell",
      "command": "npm",
      "args": [
        "install"
      ],
      "options": {
        "cwd": "${workspaceFolder}/frontend"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared",
        "focus": false,
        "clear": false
      },
      "windows": {
        "command": "npm.cmd"
      },
      "runOptions": {
        "runOn": "default"
      }
    },
    {
      "label": "Client Library: Install Dependencies",
      "type": "shell",
      "command": "npm",
      "args": [
        "install"
      ],
      "options": {
        "cwd": "${workspaceFolder}/client-library"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "npm.cmd"
      }
    },
    {
      "label": "Backend: Run Tests",
      "type": "shell",
      "command": "uv",
      "args": [
        "run",
        "pytest",
        "tests",
        "-v"
      ],
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "uv.exe"
      }
    },
    {
      "label": "Frontend: Run Tests",
      "type": "shell",
      "command": "npm",
      "args": [
        "test"
      ],
      "options": {
        "cwd": "${workspaceFolder}/frontend"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "npm.cmd"
      }
    },
    {
      "label": "Client Library: Run Tests",
      "type": "shell",
      "command": "npm",
      "args": [
        "test"
      ],
      "options": {
        "cwd": "${workspaceFolder}/client-library"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "npm.cmd"
      }
    },
    {
      "label": "Backend: Build",
      "type": "shell",
      "command": "uv",
      "args": [
        "build"
      ],
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "uv.exe"
      }
    },
    {
      "label": "Frontend: Build",
      "type": "shell",
      "command": "npm",
      "args": [
        "run",
        "build"
      ],
      "options": {
        "cwd": "${workspaceFolder}/frontend"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "npm.cmd"
      }
    },
    {
      "label": "Client Library: Build",
      "type": "shell",
      "command": "npm",
      "args": [
        "run",
        "build"
      ],
      "options": {
        "cwd": "${workspaceFolder}/client-library"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "windows": {
        "command": "npm.cmd"
      }
    }
  ]
}

